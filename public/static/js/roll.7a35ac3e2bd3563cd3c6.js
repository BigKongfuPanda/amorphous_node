webpackJsonp([2],{Cdx3:function(e,t,a){var l=a("sB3e"),r=a("lktj");a("uqUo")("keys",function(){return function(e){return r(l(e))}})},fZjL:function(e,t,a){e.exports={default:a("jFbC"),__esModule:!0}},jFbC:function(e,t,a){a("Cdx3"),e.exports=a("FeBl").Object.keys},uqUo:function(e,t,a){var l=a("kM2E"),r=a("FeBl"),i=a("S82l");e.exports=function(e,t){var a=(r.Object||{})[e]||Object[e],o={};o[e]=t(a),l(l.S+l.F*i(function(){a(1)}),"Object",o)}},vS98:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=a("mvHQ"),r=a.n(l),i=a("woOf"),o=a.n(i),n=a("Dd8w"),s=a.n(n),c=a("NYxO"),u=a("g7mi"),d=a("X2Oc"),m=a("fZjL"),f=a.n(m),b=a("E4LH"),p={castId:6,roller:"",rollMachine:null,isFlat:0,furnace:"",coilNumber:"",diameter:"",coilWeight:""},h={data:function(){return{userinfo:{},visible:!1,loading:!1,formData:{castId:6,roller:"",rollMachine:null,isFlat:0,furnace:"",coilNumber:"",diameter:"",coilWeight:""},rules:{roller:[{required:!0,message:"请选择重卷人员",trigger:"blur"}],rollMachine:[{required:!0,message:"请选择重卷机编号",trigger:"blur"}],furnace:[{required:!0,message:"请填写炉号",trigger:"blur"},{max:20,message:"最多20位字符",trigger:"blur"},{validator:b.a,trigger:"blur"}],coilNumber:[{required:!0,message:"请填写盘号",trigger:"blur"},{validator:b.f,trigger:"blur"},{validator:Object(b.d)(99999),trigger:"blur"}],diameter:[{required:!0,message:"请填写外径",trigger:"blur"},{validator:b.e,trigger:"blur"},{validator:Object(b.d)(99999),trigger:"blur"}],coilWeight:[{required:!0,message:"请填写重量",trigger:"blur"},{validator:b.b,trigger:"blur"},{validator:Object(b.d)(99999),trigger:"blur"}],isFlat:[{required:!0,message:"请选择是否平整",trigger:"blur"}]}}},props:{dialogData:{type:Object,required:!0},rollerList:{type:Array,required:!0}},created:function(){this.userinfo=JSON.parse(localStorage.getItem("userinfo")),"add"===this.dialogData.formType?this.formData=o()({},p,{castId:Number(this.$route.params.castId)}):this.formData=o()(this.formData,this.dialogData.rowData)},mounted:function(){},methods:{closeDialog:function(){this.$emit("close")},submitForm:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return!1;e.loading=!0;var a=s()({roleId:e.userinfo.roleId},e.formData),l="add"===e.dialogData.formType?{method:"POST",url:u.a.addMeasure}:{method:"PUT",url:u.a.updateMeasure},r=l.method,i=l.url;f()(a).forEach(function(e){null==a[e]&&delete a[e]}),e.$http(r,i,a).then(function(t){-1!==t.status&&(e.formData.coilNumber++,e.formData.coilWeight=null,e.formData.diameter=null,e.$emit("submit"))}).catch(function(e){console.log(e)}).finally(function(){e.loading=!1})})}}},g={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{title:"add"===e.dialogData.formType?"新增重卷记录-"+e.$route.params.castId+"号机组":"修改重卷记录-"+e.$route.params.castId+"号机组",visible:e.dialogData.dialogVisible,"close-on-click-modal":!1,"close-on-press-escape":!1,center:!0,width:"30%","element-loading-text":"拼命加载中"},on:{"update:visible":function(t){e.$set(e.dialogData,"dialogVisible",t)},close:e.closeDialog}},[a("el-form",{ref:"form",staticStyle:{},attrs:{model:e.formData,rules:e.rules,"label-width":"100px"},nativeOn:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.submitForm(t):null}}},[a("el-form-item",{attrs:{label:"重卷人员：",prop:"roller"}},[a("el-select",{attrs:{placeholder:"请选择重卷人"},model:{value:e.formData.roller,callback:function(t){e.$set(e.formData,"roller",t)},expression:"formData.roller"}},e._l(e.rollerList,function(e){return a("el-option",{key:e.roller,attrs:{value:e.roller,label:e.rollerName}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"重卷机器：",prop:"rollMachine"}},[a("el-select",{attrs:{placeholder:""},model:{value:e.formData.rollMachine,callback:function(t){e.$set(e.formData,"rollMachine",t)},expression:"formData.rollMachine"}},[a("el-option",{attrs:{label:"#1",value:1}}),e._v(" "),a("el-option",{attrs:{label:"#2",value:2}}),e._v(" "),a("el-option",{attrs:{label:"#3",value:3}}),e._v(" "),a("el-option",{attrs:{label:"#4",value:4}}),e._v(" "),a("el-option",{attrs:{label:"#5",value:5}}),e._v(" "),a("el-option",{attrs:{label:"#6",value:6}}),e._v(" "),a("el-option",{attrs:{label:"#7",value:7}}),e._v(" "),a("el-option",{attrs:{label:"#8",value:8}}),e._v(" "),a("el-option",{attrs:{label:"#9",value:9}}),e._v(" "),a("el-option",{attrs:{label:"#10",value:10}}),e._v(" "),a("el-option",{attrs:{label:"#11",value:11}}),e._v(" "),a("el-option",{attrs:{label:"#12",value:12}}),e._v(" "),a("el-option",{attrs:{label:"#13",value:13}}),e._v(" "),a("el-option",{attrs:{label:"#14",value:14}}),e._v(" "),a("el-option",{attrs:{label:"#15",value:15}}),e._v(" "),a("el-option",{attrs:{label:"#16",value:16}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"炉号：",prop:"furnace"}},[a("el-input",{model:{value:e.formData.furnace,callback:function(t){e.$set(e.formData,"furnace",t)},expression:"formData.furnace"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"盘号：",prop:"coilNumber"}},[a("el-input",{model:{value:e.formData.coilNumber,callback:function(t){e.$set(e.formData,"coilNumber",t)},expression:"formData.coilNumber"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"外径：",prop:"diameter"}},[a("el-input",{model:{value:e.formData.diameter,callback:function(t){e.$set(e.formData,"diameter",t)},expression:"formData.diameter"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"重量：",prop:"coilWeight"}},[a("el-input",{model:{value:e.formData.coilWeight,callback:function(t){e.$set(e.formData,"coilWeight",t)},expression:"formData.coilWeight"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"是否平整：",prop:"isFlat"}},[a("el-select",{attrs:{placeholder:""},model:{value:e.formData.isFlat,callback:function(t){e.$set(e.formData,"isFlat",t)},expression:"formData.isFlat"}},[a("el-option",{attrs:{value:0,label:"是"}}),e._v(" "),a("el-option",{attrs:{value:1,label:"否"}})],1)],1)],1),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeDialog}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("提交")])],1)],1)},staticRenderFns:[]},v=a("VU/8")(h,g,!1,null,null,null).exports,_=a("IC2r"),D=a("mw3O"),y=a.n(D),F=a("M4fF"),x={name:"melt",components:{dialogForm:v,Collapse:_.a},data:function(){return{userinfo:{},isAddable:!1,isEditable:!1,castId:6,searchForm:{caster:"",furnace:"",roller:"",date:[]},loading:!1,tableData:[],dialogVisible:!1,formType:"add",rowData:{},pageConfig:{total:1,current:1,pageSize:10},tableHeight:200,multipleSelection:[]}},beforeRouteUpdate:function(e,t,a){this.castId=e.params.castId,this.getTableData(),this.isAddable=this.setIsAddable(),this.isEditable=this.setIsEditable(),a()},computed:s()({},Object(c.c)(["rollerList"])),created:function(){this.castId=this.$route.params.castId,this.userinfo=JSON.parse(localStorage.getItem("userinfo")),this.isAddable=this.setIsAddable(),this.isEditable=this.setIsEditable(),this.getTableData(),this.getRollerList()},mounted:function(){var e=this;e.$nextTick(function(){e.tableHeight=window.innerHeight-100}),window.onresize=Object(d.c)(function(){e.tableHeight=window.innerHeight-100},1e3)},methods:s()({},Object(c.b)(["getRollerList"]),{getRollerName:function(e){return(this.rollerList.find(function(t){return t.roller===e})||{}).rollerName||""},dateFormat:function(e,t){return Object(d.a)(e.castDate)},rollDateFormat:function(e,t){return Object(d.b)(e.createdAt)},clickSearch:function(){this.pageConfig.current=1,this.getTableData({current:1})},reset:function(){this.searchForm={caster:"",furnace:"",roller:"",date:[]};this.pageConfig.current=1,this.getTableData({current:1})},calcLinerWeight:function(e){var t=0;return(e=Number(e))<25?t=.05:e>=25&&e<30?t=.06:e>=30&&e<40?t=.08:e>=40&&e<50?t=.12:e>=50&&e<58?t=.12:e>=58&&(t=.16),t},getTableData:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a={castId:this.castId,startTime:this.searchForm.date[0],endTime:this.searchForm.date[1],caster:this.searchForm.caster,furnace:this.searchForm.furnace,roller:this.searchForm.roller};o()(t,a),this.$http("get",u.a.queryRollData,t).then(function(t){e.pageConfig.total=t.count,e.pageConfig.pageSize=t.limit,t.list&&t.list.forEach(function(t){t.clients=t.clients?t.clients.split(","):[],t.coilNetWeight=t.coilWeight-e.calcLinerWeight(t.ribbonWidth),t.remainWeight=t.coilNetWeight}),e.tableData=t.list}).catch(function(e){console.log(e)}).finally(function(){e.loading=!1})},add:function(){this.dialogVisible=!0,this.formType="add"},edit:function(e){this.rowData=e,this.dialogVisible=!0,this.formType="edit"},del:function(e){var t=this,a=e.messageId,l=e.furnace,r=e.coilNumber;this.$confirm("该操作可能会影响检测数据，请确认没有送检和入库之后再删除","确定要删除 "+l+" 的 第 "+r+" 盘 吗？",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$http("delete",u.a.delMeasure,{messageId:a}).then(function(e){t.getTableData()}).catch(function(e){console.log(e)})}).catch(function(){})},closeHandler:function(){this.dialogVisible=!1},submitHandler:function(){"edit"===this.formType&&(this.dialogVisible=!1),this.pageConfig.current=1,this.getTableData()},handleCurrentChange:function(e){var t={current:e};this.getTableData(t)},setIsAddable:function(){return 4==this.userinfo.roleId||15==this.userinfo.roleId},setIsEditable:function(){return 4==this.userinfo.roleId||15==this.userinfo.roleId||1==this.userinfo.roleId},exportExcel:function(){var e={castId:this.castId,startTime:this.searchForm.date[0],endTime:this.searchForm.date[1],caster:this.searchForm.caster,furnace:this.searchForm.furnace,roller:this.searchForm.roller},t=u.a.exportRoll+"?"+y.a.stringify(e);window.open(t)},setSelectable:function(e,t){return 1!==e.isRollConfirmed},handleSelectionChange:function(e){this.multipleSelection=e},handleConfirm:function(){var e=this,t=Object(F.cloneDeep)(this.multipleSelection);if(0===t.length)return this.$alert("请选择带材","提示",{type:"warning"});this.$http("PUT",u.a.updateMeasure,{rollDataJson:r()(t)}).then(function(t){e.getTableData()}).catch(function(e){console.log(e)})}})},w={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-breadcrumb",{staticClass:"crumb",attrs:{"separator-class":"el-icon-arrow-right"}},[a("el-breadcrumb-item",[e._v("重卷记录")]),e._v(" "),a("el-breadcrumb-item",[e._v(e._s(e.castId)+"号机组")])],1),e._v(" "),a("Collapse",[a("el-form",{staticClass:"search_bar",attrs:{model:e.searchForm,inline:!0}},[a("el-form-item",{attrs:{label:"生产日期："}},[a("el-date-picker",{attrs:{type:"daterange","default-time":["00:00:00","23:59:59"],clearable:!1,"start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.searchForm.date,callback:function(t){e.$set(e.searchForm,"date",t)},expression:"searchForm.date"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"喷带手："}},[a("el-input",{attrs:{placeholder:"请输入喷带手姓名"},model:{value:e.searchForm.caster,callback:function(t){e.$set(e.searchForm,"caster",t)},expression:"searchForm.caster"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"炉号："}},[a("el-input",{attrs:{placeholder:"请输入炉号"},model:{value:e.searchForm.furnace,callback:function(t){e.$set(e.searchForm,"furnace",t)},expression:"searchForm.furnace"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"重卷："}},[a("el-select",{attrs:{placeholder:"请选择重卷人姓名"},model:{value:e.searchForm.roller,callback:function(t){e.$set(e.searchForm,"roller",t)},expression:"searchForm.roller"}},e._l(e.rollerList,function(e){return a("el-option",{key:e.roller,attrs:{value:e.roller,label:e.rollerName}})}),1)],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.clickSearch}},[e._v("搜索")]),e._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-refresh"},on:{click:e.reset}},[e._v("重置")])],1)],1)],1),e._v(" "),a("div",{staticClass:"main_bd"},[a("el-col",{staticClass:"table_hd"},[a("el-button",{attrs:{type:"primary",icon:"el-icon-success"},on:{click:e.handleConfirm}},[e._v("确认送检")]),e._v(" "),e.isAddable?a("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.add}},[e._v("创建重卷记录")]):e._e(),e._v(" "),a("el-button",{staticClass:"pull_right",attrs:{type:"primary",icon:"el-icon-download"},on:{click:e.exportExcel}},[e._v("导出")])],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"table",staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:"",border:"",height:e.tableHeight},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"20",selectable:e.setSelectable}}),e._v(" "),a("el-table-column",{attrs:{prop:"furnace",label:"炉号",align:"center","min-width":"130px"}}),e._v(" "),a("el-table-column",{attrs:{prop:"ribbonTypeName",label:"材质",align:"center","min-width":"60px"}}),e._v(" "),a("el-table-column",{attrs:{prop:"ribbonWidth",label:"规格",align:"center",width:"40px"}}),e._v(" "),a("el-table-column",{attrs:{prop:"castDate",label:"生产日期",align:"center",formatter:e.dateFormat,"min-width":"80px"}}),e._v(" "),a("el-table-column",{attrs:{prop:"caster",label:"喷带手",align:"center",width:"50px"}}),e._v(" "),a("el-table-column",{attrs:{prop:"coilNumber",label:"盘号",align:"center",width:"40px"}}),e._v(" "),a("el-table-column",{attrs:{prop:"diameter",label:"外径(mm)",align:"center",width:"70px"}}),e._v(" "),a("el-table-column",{attrs:{prop:"coilWeight",label:"重量(kg)",align:"center",width:"70px"}}),e._v(" "),a("el-table-column",{attrs:{prop:"rollMachine",label:"机器编号",align:"center",width:"70px"}}),e._v(" "),a("el-table-column",{attrs:{prop:"roller",label:"重卷人员",align:"center",width:"70px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.getRollerName(t.row.roller)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"createdAt",label:"重卷日期",align:"center",formatter:e.rollDateFormat,"min-width":"80px"}}),e._v(" "),a("el-table-column",{attrs:{label:"是否平整",align:"center",width:"60px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{class:{text_danger:1===t.row.isFlat}},[e._v(e._s(1===t.row.isFlat?"否":"是"))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center",width:"140px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.isEditable?a("el-button",{attrs:{size:"mini",type:"primary",disabled:e.getRollerName(t.row.roller)!==e.userinfo.adminname&&1!==e.userinfo.roleId},on:{click:function(a){e.edit(t.row)}}},[e._v("修改")]):e._e(),e._v(" "),[1,2,3,15].includes(e.userinfo.roleId)?a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){e.del(t.row)}}},[e._v("删除")]):e._e()]}}])})],1),e._v(" "),a("el-pagination",{attrs:{background:"",layout:"total,prev,pager,next",total:e.pageConfig.total,"current-page":e.pageConfig.current,"page-size":e.pageConfig.pageSize},on:{"update:currentPage":function(t){e.$set(e.pageConfig,"current",t)},"current-change":e.handleCurrentChange}})],1),e._v(" "),e.dialogVisible?a("dialog-form",{attrs:{rollerList:e.rollerList,dialogData:{formType:e.formType,dialogVisible:e.dialogVisible,rowData:e.rowData}},on:{close:e.closeHandler,submit:e.submitHandler}}):e._e()],1)},staticRenderFns:[]},k=a("VU/8")(x,w,!1,null,null,null);t.default=k.exports}});
//# sourceMappingURL=roll.7a35ac3e2bd3563cd3c6.js.map